# entando-pipelines

Scripts for automating the Entando Pipelines

# Brieft
The entando pipelines are a set of (testable) bash scripts that implement a typical git flow based on these conventions:

 - releases are bumped on release branches
 - normal development happens on the "develop" branch via feature branches
 - development of old releases occurs directly on the release branches via "hotfix" branches
 - the "master" branch only shows production releases not generated by hotfixes

 
# How to use it

## Install

```
bash <(curl -qsL "https://raw.githubusercontent.com/entando/entando-pipelines/{tag}/macro/install.sh")
```

## Run a macro

A macro is high level function that implementes a full pipeline job or step.  

```
~/ppl-run {macro-name} {args}
```

Which has 3 standardized options:

 - `--id`    the identifier of the macro execution, for messages and skip labels
 - `--lcd`   the local directly the remote project repository is or was cloned
 - `--token` a token to use insted of the one provided by the context
 
## Run a sequence of macros

```
~/ppl-run {macro-name} {args} .. {macro-name} {args} [etc..]
```

# Execution Environment:

Part of the Execution Environment is generated automatically after the context provided by the underlying pipeline engine. All the related vars follow the form:

 - `EE_...`
 
for example:
  
 - `EE_PR_TITLE`
 - `EE_PR_NUM`

# Enviroment Options:

| name | description | values |
| - | - | - |
| `ENTANDO_OPT_LOG_LEVEL`  | The log trace level |`TRACE`, `DEBUG`, `INFO`, `WARN`, `ERROR` |
| `ENTANDO_OPT_PR_TITLE_FORMAT` | the title format to enforce | **[M]** `SINGLE`,`HIERARCHICAL`,`ANY` |
| `ENTANDO_OPT_REPO_BOM_URL`  | the URL of the entando core bom | |
| `ENTANDO_OPT_SUDO` | sudo command to use | |
| `ENTANDO_OPT_NO_COL` | toggles the color ascii codes | `true`,`false` |
| `ENTANDO_OPT_STEP_DEBUG` | toggle the step debug in macros | `true`,`false` |

**[M]:** _Multiple values can be combined with the symbol_ `"|"`


# Defaults

Defaults are usually set on the organization as secrets.  
If they are not, the code assumes these ones:  


| name | default value |
| - | - |
| `ENTANDO_OPT_PR_RTITLE_FORMAT` | `SINGLE\|HIERARCHICAL` |
| `ENTANDO_OPT_REPO_BOM_URL`  | _the URL of the official Entando core bom repo_ |
| `ENTANDO_OPT_NO_COL` | `false` |
| `ENTANDO_OPT_SUDO` | `sudo` |
| `ENTANDO_OPT_STEP_DEBUG` | `false` |
